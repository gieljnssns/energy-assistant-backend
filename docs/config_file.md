# Energy Assistant Configuration file

The `energy_assistant.yaml` file is used to configure Energy Assistant. An starting point for your configuration file can be found [here](https://raw.githubusercontent.com/pail23/energy-assistant-backend/main/energy_assistant.yaml.dist).

# Home

Configure the main attributes of your home.

The following values need to be set (not optional):

- `name`: The name of the home to be displayed in the user interface.
- `solar_power`: Home Assistant entity name for the currently produced solar power.
- `solar_energy`: Home Assistant entity name for the total amount of solar energy produced by the house. Optionally this value can be generated by the integration helper in Home Assistant.
- `grid_supply_power`: Home Assistant entity name for the current power measured at the connection point of the house to the grid. This value can be positive or negative depending on current production and consumption.
- `imported_energy`: Home Assistant entity name for the total amount of energy imported from the grid.
- `exported_energy`: Home Assistant entity name for the total amount of energy imported from the grid.

## Devices

This is a list of the devices to monitored and managed by the Energy Assistant.

- `name`: The name of the device to be displayed in the user interface.
- `id`: GUID of the device. This value needs to be a valid guid and needs to be unique.
- `type`: This can either be `evcc`, `power-state-device`, `homeassistant` or `stiebel-eltron`
- `store_sessions`: Needs to be set to true in case you want to log the sessions of the devie in the Session Log.
- `energy_scale`: In case the device does provide the total energy in other units than kWh, this is the conversion factor (e.g. 0.001 in case the energy is provided in Wh.)

### Evcc Device Type

This is a device (e.g. a charger) managed by Evcc. You need to configure a MQTT connection for the Evcc connect.

- `evcc_topic`: The mqtt topic configured in the [Evcc MQTT Configuration](https://docs.evcc.io/docs/reference/configuration/mqtt).
- `load_point_id`: The Evcc id of the load point (typically the ids are just numbers from 1..x)

### power-state-device type

## Example:

```
home:
  name: "My Home"
  solar_power: sensor.solaredge_i1_ac_power
  solar_energy: sensor.solaredge_i1_ac_energy_kwh
  grid_supply_power: sensor.solaredge_m1_ac_power
  imported_energy: sensor.solaredge_m1_imported_kwh
  exported_energy: sensor.solaredge_m1_exported_kwh
  devices:
    - name: Evcc loadpoint 1
      id: 7d480adc-2c45-4de9-8f36-063c5dea0253
      type: evcc
      evcc_topic: "evcc"
      load_point_id: 1
      store_sessions: true
    - name: Tumbler
      id: 75203c88-216f-4712-8a94-80513793f7e1
      type: power-state-device
      power: sensor.tumbler_power
      energy: sensor.tumbler_energy
      energy_scale: 0.001
      store_sessions: true
      manufacturer: v-zug
      model: Adora TS WP
    - name: Server
      id: eb6b3f0a-1175-4ff3-9ebe-8c22663cba48
      type: homeassistant
      icon: mdi-server-network
      power: sensor.server_power
      energy: sensor.server_energy
      energy_scale: 0.001
```

# Mqtt

The mqtt configuration is only needed in case you would like to interface with [evcc](https://evcc.io/).

Example:

```
mqtt:
  host: homeassistant.stadel15.net
  username: smarthome
  password: smarthome!23
  topic: energyassistant
```

# Emhass

The Emhass configuration section is described in the [Emhass documentation](https://emhass.readthedocs.io/en/latest/config.html).

The following keys in the Emhass configuration are provided by Energy Assistant itself. In case you are using those keys, Energy Assistant will overwrite the values:

- hass_url
- long_lived_token
- var_PV
- var_load
- var_replace_zero
- var_interp
- time_zone
- lat
- lon
- alt

- num_def_loads
- P_deferrable_nom
- def_total_hours
- treat_def_as_semi_cont
- set_def_constant

# Home Assistant

This section is only used in case you run Energy Assistant stand alone (not as Home Assistant addon).

- `url`: URL of the home assistant instance you want to connect to.
- `token`: [Long lived access token](https://www.home-assistant.io/docs/authentication/) from Home Assistant.

Example:

```
homeassistant:
  url: https://homeassistant.example.net
  token: "your long lived home assistant token"
```
